:tocdepth: 3

.. _guppy_kr:

==
kr
==

`kr` calculates the Kantorovich-Rubinstein distance and corresponding p-values.

::

  usage: kr [options] placefiles

Options
=======

--pp  Use posterior probability for the weight.
--unweighted  Treat every placement as a point mass concentrated on the highest-weight placement.
--transform  A transform to apply to the read multiplicities before calculating. Options are 'log' and 'unit'. Default is no transform.
-c  Reference package path.
-o  Specify the filename to write to.
--out-dir  Specify the directory to write files to.
--prefix  Specify a string to be prepended to filenames.
-p  The exponent for the integration, i.e. the value of p in Z_p.
--normalize  Divide KR by a given value. Legal arguments are "tree-length".
--seed  Set the random seed, an integer > 0. Default is 1.
--list-out  Output the KR results as a list rather than a matrix.
--density  Make density plots showing the distribution of randomized values with the calculated values
-s  Set how many samples to use for significance calculation (0 means calculate distance only). Default is 0.
--gaussian  Use the Gaussian process approximation for p-value estimation

Details
=======


``kr`` calculates the Kantorovich-Rubinstein distance between collections of placements (given by their place files) by its closed form formula

.. math::
    Z(P,Q) =
    \int_T \left| P(\tau(y)) - Q(\tau(y)) \right| \, \lambda(dy).

This is a generalization of the UniFrac distance (UniFrac can only place mass at leaves and cannot accomodate uncertainty).
There is a further generalization to an :math:`L^p` Zolotarev-type version:
for :math:`0 < p < \infty` we have the distances

.. math::

    Z_p(P,Q) =
    \left[\int_T \left| P(\tau(y)) - Q(\tau(y)) \right|^p \, \lambda(dy)\right]^{\frac{1}{p} \wedge 1}

which can be used to vary the impact of mass relative to transport.
A larger :math:`p` increases the impact of differences of mass, while a smaller :math:`p` emphasizes distance traveled.

Note that the significance p-values calculated by ``-s`` or ``--normal`` are not corrected for multiple comparison.
